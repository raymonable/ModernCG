--[[

ModernCG Modules

Credits:
 RbxmSuite: https://github.com/richie0866/rbxm-suite
 Demojify: https://github.com/buildthomas/Demojify

--]]

local function lookupify(t) local r = {} for _, v in pairs(t) do r[v] = true end return r end
local blockedRanges = { {0x0001F601, 0x0001F64F}, {0x00002702, 0x000027B0}, {0x0001F680, 0x0001F6C0}, {0x000024C2, 0x0001F251}, {0x0001F300, 0x0001F5FF}, {0x00002194, 0x00002199}, {0x000023E9, 0x000023F3}, {0x000025FB, 0x000026FD}, {0x0001F300, 0x0001F5FF}, {0x0001F600, 0x0001F636}, {0x0001F681, 0x0001F6C5}, {0x0001F30D, 0x0001F567}, {0x0001F980, 0x0001F984}, {0x0001F910, 0x0001F918}, {0x0001F6E0, 0x0001F6E5}, {0x0001F920, 0x0001F927}, {0x0001F919, 0x0001F91E}, {0x0001F933, 0x0001F93A}, {0x0001F93C, 0x0001F93E}, {0x0001F985, 0x0001F98F}, {0x0001F940, 0x0001F94F}, {0x0001F950, 0x0001F95F}, {0x0001F928, 0x0001F92F}, {0x0001F9D0, 0x0001F9DF}, {0x0001F9E0, 0x0001F9E6}, {0x0001F992, 0x0001F997}, {0x0001F960, 0x0001F96B}, {0x0001F9B0, 0x0001F9B9}, {0x0001F97C, 0x0001F97F}, {0x0001F9F0, 0x0001F9FF}, {0x0001F9E7, 0x0001F9EF}, {0x0001F7E0, 0x0001F7EB}, {0x0001FA90, 0x0001FA95}, {0x0001F9A5, 0x0001F9AA}, {0x0001F9BA, 0x0001F9BF}, {0x0001F9C3, 0x0001F9CA}, {0x0001FA70, 0x0001FA73}, }
local blockedSingles = lookupify { 0x000000A9, 0x000000AE, 0x0000203C, 0x00002049, 0x000020E3, 0x00002122, 0x00002139, 0x000021A9, 0x000021AA, 0x0000231A, 0x0000231B, 0x000025AA, 0x000025AB, 0x000025B6, 0x000025C0, 0x00002934, 0x00002935, 0x00002B05, 0x00002B06, 0x00002B07, 0x00002B1B, 0x00002B1C, 0x00002B50, 0x00002B55, 0x00003030, 0x0000303D, 0x00003297, 0x00003299, 0x0001F004, 0x0001F0CF, 0x0001F6F3, 0x0001F6F4, 0x0001F6E9, 0x0001F6F0, 0x0001F6CE, 0x0001F6CD, 0x0001F6CF, 0x0001F6CB, 0x00023F8, 0x00023F9, 0x00023FA, 0x0000023, 0x0001F51F, 0x0001F6CC, 0x0001F9C0, 0x0001F6EB, 0x0001F6EC, 0x0001F6D0, 0x00023CF, 0x000002A, 0x0002328, 0x0001F5A4, 0x0001F471, 0x0001F64D, 0x0001F64E, 0x0001F645, 0x0001F646, 0x0001F681, 0x0001F64B, 0x0001F647, 0x0001F46E, 0x0001F575, 0x0001F582, 0x0001F477, 0x0001F473, 0x0001F930, 0x0001F486, 0x0001F487, 0x0001F6B6, 0x0001F3C3, 0x0001F57A, 0x0001F46F, 0x0001F3CC, 0x0001F3C4, 0x0001F6A3, 0x0001F3CA, 0x00026F9, 0x0001F3CB, 0x0001F6B5, 0x0001F6B5, 0x0001F468, 0x0001F469, 0x0001F990, x0001F991, 0x0001F6F5, 0x0001F6F4, 0x0001F6D1, 0x0001F6F6, 0x0001F6D2, 0x0002640, 0x0002642, 0x0002695, 0x0001F3F3, 0x0001F1FA, 0x0001F91F, 0x0001F932, 0x0001F931, 0x0001F9F8, 0x0001F9F7, 0x0001F3F4, 0x0001F970, 0x0001F973, 0x0001F974, 0x0001F97A, 0x0001F975, 0x0001F976, 0x0001F9B5, 0x0001F9B6, 0x0001F468, 0x0001F469, 0x0001F99D, 0x0001F999, 0x0001F99B, 0x0001F998, 0x0001F9A1, 0x0001F99A, 0x0001F99C, 0x0001F9A2, 0x0001F9A0, 0x0001F99F, 0x0001F96D, 0x0001F96C, 0x0001F96F, 0x0001F9C2, 0x0001F96E, 0x0001F99E, 0x0001F9C1, 0x0001F6F9, 0x0001F94E, 0x0001F94F, 0x0001F94D, 0x0000265F, 0x0000267E, 0x0001F3F4, 0x0001F971, 0x0001F90E, 0x0001F90D, 0x0001F90F, 0x0001F9CF, 0x0001F9CD, 0x0001F9CE, 0x0001F468, 0x0001F469, 0x0001F9D1, 0x0001F91D, 0x0001F46D, 0x0001F46B, 0x0001F46C, 0x0001F9AE, 0x0001F415, 0x0001F6D5, 0x0001F6FA, 0x0001FA82, 0x0001F93F, 0x0001FA80, 0x0001FA81, 0x0001F97B, 0x0001F9AF, 0x0001FA78, 0x0001FA79, 0x0001FA7A, }
return {
  Demojify = function(String)
    local codepoints = {} for _, codepoint in utf8.codes(String) do local insert = true if blockedSingles[codepoint] then insert = false else for _, range in ipairs(blockedRanges) do if range[1] <= codepoint and codepoint <= range[2] then insert = false break end end end if insert then table.insert(codepoints, codepoint) end end return utf8.char(unpack(codepoints))
  end,
  Rbxm = function()
    local a="rbxm-suite"local b="_rbxm-suite-v2"local c=b.."/temp.dat"local d=game:GetService("HttpService")local e=getcustomasset or getsynasset or error("Failed to load model! (No custom asset loader found)")local function f(g,h)local i=getgenv(g)["__rbxm_suite_"..g]if i==nil then i=h;getgenv(g)["__rbxm_suite_"..g]=i end;return i end;local function j(k,l)if k==nil then return l else return k end end;local function m(n)local o,p=game:HttpGetAsync(n)return assert(o,"Error "..tostring(p)..": Failed to GET from "..n)end;local function q(r,s)if s then print(r)end end;local t;do t={}local function u()if not isfolder(b)then makefolder(b)makefolder(b.."/models")writefile(b.."/latest.json","{}")end end;local function v(w)local x=readfile(b.."/latest.json")local y=d:JSONDecode(x)w(y)writefile(b.."/latest.json",d:JSONEncode(y))end;local function z(A)local x=readfile(b.."/latest.json")local y=d:JSONDecode(x)return y[A]end;local function B(C,D)local o=m("https://api.github.com/repos/"..C.."/"..D.."/releases/latest")return d:JSONDecode(o).tag_name end;local function E(C,D,F,A,G)local H=B(C,D)if isfile(G)and z(A)==H then return G end;local o=m("https://github.com/"..C.."/"..D.."/releases/latest/download/"..F)writefile(G,o)v(function(y)y[A]=H end)end;function t.download(C,D,I,F)local A=string.gsub(table.concat({C,D,I,F},"-"),"[^a-zA-Z0-9_%-]","_")local G=b.."/models/"..A..".rbxm"if I=="latest"then if isfile(G)then task.defer(E,C,D,F,A,G)else E(C,D,F,A,G)end;return G end;if isfile(G)then return G end;local o=m("https://github.com/"..C.."/"..D.."/releases/download/"..I.."/"..F)writefile(G,o)return G end;function t.clearCache()delfolder(b)u()end;u()end;local J=f("modules",{})local K={}local L=f("idToScript",{})local M=f("scriptToId",{})local N=f("globalMap",{})local function O(P,Q,R)local S=J[P]if S.isLoaded then return S.data end;if Q and not R then K[Q]=P;local T=P;local U=0;while T do U=U+1;T=K[T]if T==P then local V=T:GetFullName()for W=1,U do T=K[T]V=V.."  ⇒ "..T:GetFullName()end;error("Failed to load '"..P:GetFullName().."'! Detected a circular dependency chain: "..V,2)end end end;local x=S.fn()if K[Q]==P then K[Q]=nil end;S.data=x;S.isLoaded=true;return x end;local function X()local Y={}local function Z(V)table.insert(Y,V)end;local function _()return table.concat(Y)end;return{push=Z,concat=_}end;local function a0(P,R)local A=d:GenerateGUID()local function a1(a2)if typeof(a2)=="Instance"and J[a2]then return O(a2,P,R)else return require(a2)end end;J[P]={data=nil,fn=nil,isLoaded=false}L[A]=P;M[P]=A;N[A]={P,a1}return A end;local function a3(a4)a4.push("local modules, globalMap, idToScript = ...")end;local function a5(P,a4,a6)if not P:IsA("LocalScript")and not P:IsA("ModuleScript")then return end;local A=string.format("%q",a0(P,not a6.nocirculardeps))local G=string.format("%q","@"..a.."."..P:GetFullName())if a6.debug then P.Source="local script, require = unpack((...)["..A.."]); "..P.Source;a4.push("modules[idToScript["..A.."]].fn = function ()\n".."local fn, err = loadstring(idToScript["..A.."].Source, "..G..")\n".."return assert(fn, err)(globalMap)\n".."end\n")return end;P.Source="local script, require = unpack(globalMap["..A.."]); "..P.Source;a4.push("modules[idToScript["..A.."]].fn = function ()\n"..P.Source.."\nend\n")end;local function a7(n,s)local a8=string.match(n,"^rbxassetid://(%d+)$")if not a8 then return game:GetObjects(n)end;local x=d:JSONDecode(m("https://assetdelivery.roblox.com/v2/assetId/"..a8))local a9=m(x.locations[1].location)if a9==""then q("⚠️ Model data for asset "..a8 .." is blank!",s)return game:GetObjects(n)end;writefile(c,a9)local aa,ab=pcall(function()return game:GetObjects(e(c))end)delfile(c)if not aa then q("⚠️ Model data for asset "..a8 .." failed to load! "..tostring(ab),s)return game:GetObjects(n)end;return ab end;local function ac(n,a6)if string.find(n,"^rbxassetid://")then if a6.nocache then return a7(n,a6.verbose)end;return game:GetObjects(n)else return game:GetObjects(e(n))end end;local function ad(a4,ae,a6)a5(ae,a4,a6)for W,P in ipairs(ae:GetDescendants())do a5(P,a4,a6)end end;local function af(a4)assert(loadstring(a4.concat(),"@"..a))(J,N,L)end;local function ag(P,ah,a6)local ai=a6.deferred and task.defer or task.spawn;ai(function()q("ℹ️ "..ah.." Running "..P:GetFullName(),a6.verbose)O(P)q("✅ "..ah.." Done!",a6.verbose)end)end;local function aj(ae,a6)local ak=0;if ae:IsA("LocalScript")and not ae.Disabled then ak=ak+1;ag(ae,ak,a6)end;for W,P in ipairs(ae:GetDescendants())do if P:IsA("LocalScript")and not P.Disabled then ak=ak+1;ag(P,ak,a6)end end end;local function al(n,am)assert(type(n)=="string","The first argument 'url' must be a string.")assert(type(am)=="table"or am==nil,"The second argument 'options' must be a table or nil.")am=am or{}local a6={runscripts=j(am.runscripts,true),deferred=j(am.deferred,true),nocache=j(am.nocache,false),nocirculardeps=j(am.nocirculardeps,true),debug=j(am.debug,false),verbose=j(am.verbose,false)}q("\n\n"..utf8.char(0x1F680).." Launching file '"..n.."'\n",a6.verbose)local an=os.clock()local ao=ac(n,a6)local a4=X()a3(a4)for W,ae in ipairs(ao)do ad(a4,ae,a6)end;af(a4)if a6.runscripts then for W,ae in ipairs(ao)do aj(ae,a6)end end;q("\n\n"..utf8.char(0x1F389).." Done! Took "..string.format("%.2f",(os.clock()-an)*1000).." milliseconds.\n",a6.verbose)return unpack(ao)end;local function require(P)assert(typeof(P)=="Instance","The script must be an Instance.")assert(P:IsA("LuaSourceContainer"),"The script must be a Lua module or script.")assert(J[P],"The script must be registered with rbxmSuite.")return O(P)end;local function ap(aq,F)local C,D,I=string.match(aq,"([^/]+)/([^@]+)@?(.*)")assert(C and D,"Invalid repository format.")assert(type(F)=="string","The asset must be a string.")if I==""or I==nil then I="latest"end;return t.download(C,D,I,F)end;local function ar()return t.clearCache()end;return{launch=al,require=require,download=ap,clearCache=ar}
  end
}
